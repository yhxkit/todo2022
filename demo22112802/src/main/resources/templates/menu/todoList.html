<!DOCTYPE html>
<html class="no-js" lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layouts/main_layout}">


    <th:block layout:fragment="content">


        <article class="content item-editor-page">
            <div class="title-block">
                <h3 class="title"> To Do List
                    <span class="sparkline bar" data-type="bar"></span>
                </h3>
            </div>


            <form name="banner_form">
                <div class="card card-block">

<!--                    <div class="form-group row">-->
<!--                        <label class="col-sm-2 form-control-label text-xs-right"> Category: </label>-->
<!--                        <div class="col-sm-10">-->
<!--                            <select class="c-select form-control boxed" id="bn_select_box" onchange="setbanner();">-->
<!--                                <option value="BANNER_QUICK" th:selected="${fixedOption == 'BANNER_QUICK'}">퀵 배너</option>-->
<!--                                <option value="BANNER_CHARGE" th:selected="${fixedOption == 'BANNER_CHARGE'}">CC 충전</option>-->
<!--                                <option value="BANNER_MAINTENANCE" th:selected="${fixedOption == 'BANNER_MAINTENANCE'}">정기-->
<!--                                    업데이트-->
<!--                                </option>-->
<!--                            </select>-->
<!--                        </div>-->
<!--                    </div>-->

                    <div class="form-group row">
                        <label class="col-sm-2 form-control-label text-xs-right"> To Do List : </label>
                        <div class="col-sm-10">
                            <div class="images-container" id="banner-thumbnail-container">


                                <div class="image-container" th:each="todo : ${todos}" th:object="${todo}">
                                    <div class="controls">
                                        <a class="control-btn move">
                                            <i class="fa fa-arrows"></i>
                                        </a>
                                        <a class="control-btn new" data-toggle="modal" data-target="#banner-info"
                                           onclick="bannerInfoToAppend = $(this).parent().parent().find('.uploadingimg input'); $('#bnTextInfo').val(bannerInfoToAppend.attr('data-bntext')); $('#bnTargetInfo').val(bannerInfoToAppend.attr('data-bntarget')); $('#bnCssClassInfo').val(bannerInfoToAppend.attr('data-bncssclass')); $('#bnUrlInfo').val(bannerInfoToAppend.attr('data-bnurl'));  $('#bnNoteInfo').val(bannerInfoToAppend.attr('data-bnnote')); ">
                                            <i class="fa fa-pencil"></i>
                                        </a>
                                        <a class="control-btn remove" data-toggle="modal"
                                           data-target="#confirm-modal"
                                           onclick="bannerToRemove = $(this).parent().parent();">
                                            <i class="fa fa-trash-o"></i>
                                        </a>
                                    </div>


                                    <div class="text uploadingimg ">
                                        <input class="menu_text todo_title_area" style="height: 60px; width: 600px" type="text" placeholder="제목을 입력하세요"
                                               th:data-todoidx="*{idx}"  th:data-todotitle="*{title}"
                                               th:value="*{title}"/>
                                    </div>
                                </div>


                            </div>


                            <div class="image-container">
                                <a onclick="add_quickbanner_edit_box();">
                                    <div class="image-container new">
                                        <div class="image">
                                            <i class="fa fa-plus"></i>
                                        </div>
                                    </div>
                                </a>
                            </div>


                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="col-sm-10 col-sm-offset-2">
                            <button type="submit" class="btn btn-primary"
                                    th:onclick="'event.preventDefault(); javascript:submit_banner();'"> Submit
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </article>


        <div class="modal fade" id="banner-info">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">

                    <div class="modal-header">
                        <h4 class="modal-title">할일 상세 설정</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                            <span class="sr-only">Close</span>
                        </button>
                    </div>

                    <div class="modal-body modal-tab-container">
                        <div class="tab-content modal-tab-content card card-block">
                            <div class="form-group">
                                <label for="bnNoteInfo">NOTE</label>
                                <input type="text" class="form-control" id="bnNoteInfo" placeholder="Note">
                            </div>
                            <div class="form-group">
                                <label for="bnUrlInfo">URL</label>
                                <input type="text" class="form-control" id="bnUrlInfo" placeholder="Url">
                            </div>
                            <div class="form-group">
                                <label for="bnCssClassInfo">CLASS</label>
                                <input type="text" class="form-control" id="bnCssClassInfo" placeholder="Class">
                            </div>
                            <div class="form-group">
                                <label for="bnTextInfo">Text</label>
                                <input type="text" class="form-control" id="bnTextInfo" placeholder="Text">
                            </div>
                            <div class="form-group">
                                <label for="bnTargetInfo">Target</label>
                                <input type="text" class="form-control" id="bnTargetInfo" placeholder="Target">
                            </div>
                        </div>


                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-dismiss="modal"
                                onclick="bannerInfoToAppend.attr('data-bnurl', $('#bnUrlInfo').val());  bannerInfoToAppend.attr('data-bntext', $('#bnTextInfo').val()); bannerInfoToAppend.attr('data-bntarget', $('#bnTargetInfo').val()); bannerInfoToAppend.attr('data-bncssclass', $('#bnCssClassInfo').val()); bannerInfoToAppend.attr('data-bnnote', $('#bnNoteInfo').val());  ">
                            Complete
                        </button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        </div>
        <!-- /.modal -->


        <div class="modal fade" id="confirm-modal">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">
                            <i class="fa fa-warning"></i> Alert</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <p>배너를 삭제합니다</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-dismiss="modal"
                                onclick=" bannerToRemove.remove();  ">
                            Yes
                        </button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
                    </div>
                </div>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        </div>
        <!-- /.modal -->


        <script>
            let bannerInfoToAppend;
            let bannerToRemove;

            function add_quickbanner_edit_box() {

                const thum = '<div class="image-container"><div class="controls">'
                    + '<a class="control-btn move">'
                    + '<i class="fa fa-arrows"></i>'
                    + '</a>'
                    + ' <a class="control-btn new" data-toggle="modal" data-target="#banner-info"  onclick = "bannerInfoToAppend = $(this).parent().parent().find(\'.uploadingimg input \'); $(\'#bnTextInfo\').val(bannerInfoToAppend.attr(\'data-bntext\'));   $(\'#bnTargetInfo\').val(bannerInfoToAppend.attr(\'data-bntarget\'));  $(\'#bnCssClassInfo\').val(bannerInfoToAppend.attr(\'data-bncssclass\'));  $(\'#bnUrlInfo\').val(bannerInfoToAppend.attr(\'data-bnurl\'));  $(\'#bnNoteInfo\').val(bannerInfoToAppend.attr(\'data-bnnote\')); ">'
                    + '  <i class="fa fa-pencil"></i>'
                    + '</a>'
                    + ' <a class="control-btn remove" data-toggle="modal" data-target="#confirm-modal" onclick="bannerToRemove = $(this).parent().parent();">'
                    + '<i class="fa fa-trash-o"></i>'
                    + '</a>'
                    + '</div>'
                    + '<div class="text uploadingimg todo_title_area"><input class="banner_text" style="height: 60px; width: 600px" type="text" placeholder="타이틀 입력" /></div>'
                    + '</div>';

                $('#banner-thumbnail-container').append(thum);


            }


            function submit_banner() {

                let sending_obj = {};

                const selectedBnOption = $('#bn_select_box option:selected').val();
                const bnnum = $('#banner-thumbnail-container .uploadingimg').length;

                let banner = new Array();


                for (let i = 0; i < bnnum; i++) {
                    let Banner = {};
                    // console.log("모든 배너 이름은 " + $('#banner-thumbnail-container .uploadingimg').eq(i).find('input').val());
                    Banner.bnRole = selectedBnOption;
                    Banner.bnIdx = $('#banner-thumbnail-container .uploadingimg').eq(i).find('input').data('bnidx');
                    Banner.bnFileName = $('#banner-thumbnail-container .uploadingimg').eq(i).find('input').val();
                    Banner.bnUrl = $('#banner-thumbnail-container .uploadingimg').eq(i).find('input').data('bnurl');
                    Banner.bnNote = $('#banner-thumbnail-container .uploadingimg').eq(i).find('input').data('bnnote');
                    Banner.bnCssClass = $('#banner-thumbnail-container .uploadingimg').eq(i).find('input').data('bncssclass');
                    Banner.bnTarget = $('#banner-thumbnail-container .uploadingimg').eq(i).find('input').data('bntarget');
                    Banner.bnText = $('#banner-thumbnail-container .uploadingimg').eq(i).find('input').data('bntext');
                    banner.push(Banner);
                }
                sending_obj['bannerList'] = banner;
                sending_obj['bannerRole'] = selectedBnOption;

                // console.log("보낼 결과 " + JSON.stringify(sending_obj));

                complete_bn_upload(JSON.stringify(sending_obj), selectedBnOption);

            }

            function complete_bn_upload(sending_obj, selectedBnOption) {
                $.ajax({
                    url: root + '/home_admin/banner',
                    type: 'post',
                    data: sending_obj,
                    contentType: 'application/json; charset=utf-8',
                    success: function (data) {
                        // console.log(JSON.stringify(data));
                        alert(data['message']);
                        window.location.href = root + "/home_admin/side_banner/" + selectedBnOption;
                    },
                    error: function (data) {
                        getMessage(data);
                    }
                });
            }

            function setbanner() {
                var selected_bn_option = $('#bn_select_box option:selected').val();
                // console.log("현재 선택된 배너 페이지 " + selected_bn_option);
                window.location.href = root + "/home_admin/side_banner/" + selected_bn_option;
            }


        </script>

    </th:block>